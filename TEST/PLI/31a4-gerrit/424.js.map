{"version":3,"sources":["webpack://phenix/./node_modules/@babel/runtime/helpers/arrayLikeToArray.js","webpack://phenix/./node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack://phenix/./node_modules/@babel/runtime/helpers/classCallCheck.js","webpack://phenix/./node_modules/@babel/runtime/helpers/createClass.js","webpack://phenix/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://phenix/./node_modules/@babel/runtime/helpers/iterableToArray.js","webpack://phenix/./node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack://phenix/./node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack://phenix/./node_modules/@babel/runtime/helpers/toPrimitive.js","webpack://phenix/./node_modules/@babel/runtime/helpers/toPropertyKey.js","webpack://phenix/./node_modules/@babel/runtime/helpers/typeof.js","webpack://phenix/./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","webpack://phenix/./src/dom/BrowserDetector.ts","webpack://phenix/./src/sdk/transformation/SurrogateFrameDataManager.ts","webpack://phenix/./src/sdk/transformation/WorkerTransformStream.ts"],"names":["module","exports","arr","len","length","i","arr2","Array","__esModule","arrayLikeToArray","isArray","instance","Constructor","TypeError","toPropertyKey","_defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","obj","value","iter","Symbol","iterator","from","arrayWithoutHoles","iterableToArray","unsupportedIterableToArray","nonIterableSpread","_typeof","t","r","e","toPrimitive","call","String","Number","o","constructor","minLen","n","toString","slice","name","test","BrowserDetector","_classCallCheck","_createClass","get","_browserNameAndVersion","this","_browserName","_browserMajorVersion","_isMobile","_isAndroid","_isChrome69","_isChrome70","_isChrome71","_isChrome72","_isChrome74","_isChrome75","_isChrome76","_isChrome77","navigator","userAgent","browserNameAndVersion","match","_browserNameAndVersionRegex","parseBrowserNameAndVersionForIE","browserNameList","split","browserVersionList","fullVersion","msie","indexOf","concat","parseInt","substring","version","_BrowserDetector","_defineProperty","parseBrowserNameAndVersion","parseBrowserName","parseBrowserMajorVersion","_navigator","_navigator2","includes","SkipFrame","SurrogateFrameDataManager","Error","codec","toUpperCase","_dummyAudioSilentPerCodec","OPUS","buffer","_singleZeroByte","_useUpdateSurrogate82x82PFrameFrameNumber","_surrogate82x82PFrameFrameNumber","_surrogate82x82PFrameFrameNumberReset","_dummy82x82H264","IFrame","_dummy2x2VideoIFramePerCodec","H264","VP8","VP9","_isAndroidChrome","getSurrogate82x82PFrameAndUpdateFrameNumber","_dummy2x2VideoPFramePerCodec","savedSurrogateFrameNumber","byte1","byte2","PFrame","bufferIndex","_dummy82x82H264PFrameFrameNumberIndex","_SurrogateFrameDataManager","browserName","isMobile","isAndroid","Uint8Array","_toConsumableArray","fill","_isMobileChrome","_isSafari","self","onmessage","event","WorkerTransformStream","forceInvalidFrame","data","RTCTransformEvent","onrtctransform","transformer","options","transformFunction","kind","videoTransformFunction","audioTransformFunction","transformStream","TransformStream","transform","source","readable","sink","pipeThrough","pipeTo","chunk","controller","postMessage","type","timestamp","surrogate","getInvalidSurrogateVideoIFrame","getInvalidSurrogateVideoPFrame","getSurrogateVideoIFramePerCodec","getSurrogateVideoPFramePerCodec","enqueue","getInvalidSurrogateAudioData","getSurrogateAudioSilentPerCodec"],"mappings":"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","file":"424.js","sourcesContent":["function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nmodule.exports = _arrayLikeToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\nmodule.exports = _arrayWithoutHoles, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nmodule.exports = _classCallCheck, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nmodule.exports = _createClass, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var toPropertyKey = require(\"./toPropertyKey.js\");\nfunction _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nmodule.exports = _defineProperty, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nmodule.exports = _iterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nmodule.exports = _nonIterableSpread, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayWithoutHoles = require(\"./arrayWithoutHoles.js\");\nvar iterableToArray = require(\"./iterableToArray.js\");\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\nvar nonIterableSpread = require(\"./nonIterableSpread.js\");\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\nmodule.exports = _toConsumableArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nmodule.exports = toPrimitive, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nvar toPrimitive = require(\"./toPrimitive.js\");\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : String(i);\n}\nmodule.exports = toPropertyKey, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return (module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports), _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\nmodule.exports = _unsupportedIterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/**\n * Copyright 2024 Phenix Real Time Solutions, Inc. Confidential and Proprietary. All Rights Reserved.\n */\nexport default class BrowserDetector {\n  private static readonly _browserNameAndVersionRegex = /(MSIE|(?!Gecko.+)Firefox|(?!AppleWebKit.+Chrome.+)Safari|(?!AppleWebKit.+)Chrome|AppleWebKit(?!.+Chrome|.+Safari)|Gecko(?!.+Firefox))(?: |\\/)([\\d.apre]+)/g;\n  private static readonly _browserNameAndVersion = BrowserDetector.parseBrowserNameAndVersion();\n  private static readonly _browserName = BrowserDetector.parseBrowserName();\n  private static readonly _browserMajorVersion = BrowserDetector.parseBrowserMajorVersion();\n\n  private static readonly _isMobile = (/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini/i).test(navigator?.userAgent);\n  private static readonly _isAndroid = (/Android/i).test(navigator?.userAgent);\n\n  private static readonly _isChrome69 = BrowserDetector._browserNameAndVersion.includes('Chrome/69.');\n  private static readonly _isChrome70 = BrowserDetector._browserNameAndVersion.includes('Chrome/70.');\n  private static readonly _isChrome71 = BrowserDetector._browserNameAndVersion.includes('Chrome/71.');\n  private static readonly _isChrome72 = BrowserDetector._browserNameAndVersion.includes('Chrome/72.');\n  private static readonly _isChrome74 = BrowserDetector._browserNameAndVersion.includes('Chrome/74.');\n  private static readonly _isChrome75 = BrowserDetector._browserNameAndVersion.includes('Chrome/75.');\n  private static readonly _isChrome76 = BrowserDetector._browserNameAndVersion.includes('Chrome/76.');\n  private static readonly _isChrome77 = BrowserDetector._browserNameAndVersion.includes('Chrome/77.');\n\n  static get browserNameAndVersion(): string {\n    return BrowserDetector._browserNameAndVersion;\n  }\n\n  static get browserName(): string {\n    return this._browserName;\n  }\n\n  static get browserMajorVersion(): number {\n    return this._browserMajorVersion;\n  }\n\n  static isMobile(): boolean {\n    return BrowserDetector._isMobile;\n  }\n\n  static get isAndroid(): boolean {\n    return BrowserDetector._isAndroid;\n  }\n\n  static get isChrome69(): boolean {\n    return BrowserDetector._isChrome69;\n  }\n\n  static get isChrome70(): boolean {\n    return BrowserDetector._isChrome70;\n  }\n\n  static get isChrome71(): boolean {\n    return BrowserDetector._isChrome71;\n  }\n\n  static get isChrome72(): boolean {\n    return BrowserDetector._isChrome72;\n  }\n\n  static get isChrome74(): boolean {\n    return BrowserDetector._isChrome74;\n  }\n\n  static get isChrome75(): boolean {\n    return BrowserDetector._isChrome75;\n  }\n\n  static get isChrome76(): boolean {\n    return BrowserDetector._isChrome76;\n  }\n\n  static get isChrome77(): boolean {\n    return BrowserDetector._isChrome77;\n  }\n\n  private static parseBrowserNameAndVersion(): string {\n    if (!navigator || !navigator.userAgent) {\n      return '';\n    }\n\n    const browserNameAndVersion = navigator.userAgent.match(BrowserDetector._browserNameAndVersionRegex);\n\n    if (browserNameAndVersion && browserNameAndVersion[0]) {\n      return browserNameAndVersion[0];\n    }\n\n    return BrowserDetector.parseBrowserNameAndVersionForIE();\n  }\n\n  private static parseBrowserName(): string {\n    if (!BrowserDetector._browserNameAndVersion) {\n      return '';\n    }\n\n    const browserNameList = BrowserDetector._browserNameAndVersion.split('/');\n\n    if (!browserNameList || !browserNameList[0]) {\n      return '';\n    }\n\n    return browserNameList[0];\n  }\n\n  private static parseBrowserMajorVersion(): number {\n    if (!BrowserDetector._browserNameAndVersion) {\n      return 0;\n    }\n\n    const browserVersionList = BrowserDetector._browserNameAndVersion.split('/');\n\n    if (!browserVersionList || !browserVersionList[1]) {\n      return 0;\n    }\n\n    const fullVersion = browserVersionList[1];\n\n    if (!fullVersion) {\n      return 0;\n    }\n\n    return Number(fullVersion.split('.')[0]) || 0;\n  }\n\n  private static parseBrowserNameAndVersionForIE(): string {\n    if (!navigator || !navigator.userAgent) {\n      return '';\n    }\n\n    const userAgent = navigator.userAgent;\n    const msie = userAgent.indexOf('MSIE ');\n\n    if (msie > 0) {\n      // IE 10 or older => return version number\n      return `IE/${parseInt(userAgent.substring(msie + 5, userAgent.indexOf('.', msie)), 10)}`;\n    }\n\n    const trident = userAgent.indexOf('Trident/');\n\n    if (trident > 0) {\n      // IE 11 => return version number\n      const version = userAgent.indexOf('rv:');\n\n      return `IE/${parseInt(userAgent.substring(version + 3, userAgent.indexOf('.', version)), 10)}`;\n    }\n\n    return '';\n  }\n}","/**\n * Copyright 2024 Phenix Real Time Solutions, Inc. Confidential and Proprietary. All Rights Reserved.\n */\n\nimport BrowserDetector from '../../dom/BrowserDetector';\n\nexport const SkipFrame = Symbol();\n\nexport type SurrogateFrameType = ArrayBuffer | undefined | typeof SkipFrame;\n\nexport default class SurrogateFrameDataManager {\n  private static readonly _isSafari = BrowserDetector.browserName === 'Safari';\n  private static readonly _isMobileChrome = BrowserDetector.browserName === 'Chrome' && BrowserDetector.isMobile();\n  private static readonly _isAndroidChrome = BrowserDetector.browserName === 'Chrome' && BrowserDetector.isAndroid;\n  private static readonly _singleZeroByte = new Uint8Array([0x00]);\n  private static readonly _dummyAudioSilentPerCodec = {OPUS: new Uint8Array([0x68, 0x07, 0xd9, 0xab, 0xbc, 0x79, 0x87, 0xab, 0x8e, 0x4a, 0x14, 0xf3, 0xa7, 0x1c, 0xf2, 0x9a, 0x7a, 0x45, 0xa7, 0x2d, 0x44, 0x25, 0x74, 0x4c, 0xad, 0x16, 0xb3, 0x0e, 0x51, 0x57, 0xea, 0xe7, 0xad, 0x2a, 0x38, 0xce, 0x33])};\n  private static readonly _dummy2x2VideoIFramePerCodec = {\n    H264: new Uint8Array([\n      0x00, 0x00, 0x00, 0x01, 0x09, 0xf0, // Access unit delimiter\n      0x00, 0x00, 0x00, 0x01, 0x67, 0xf4, 0x00, 0x0a, 0x91, 0x9b, 0x2b, 0xf1, 0xf1, 0xf8, 0x08, 0x80, 0x00, 0x00, 0x03, 0x00, 0x80, 0x00, 0x00, 0x19, 0x07, 0x89, 0x12, 0xcb, // Sequence parameter set\n      0x00, 0x00, 0x00, 0x01, 0x68, 0xeb, 0xe3, 0xc4, 0x48, 0x44, // Picture paramter set\n      /* */ 0x00, 0x00, 0x01, 0x65, 0x88, 0x82, 0x00, 0x3f, 0x70, 0x23, 0x86, 0xe6, 0xd1, 0x80, 0x09, 0xaf, 0x0a, 0x41, 0x66, 0x6b, 0x54, 0x46, 0xfb, 0x71, 0xd9, 0x7f, 0xff, 0xff, 0xf9]), // Slice layer: idr data\n    VP8: new Uint8Array([0xb0, 0x02, 0x00, 0x9d, 0x01, 0x2a, 0x01, 0x00, 0x01, 0x00, 0x39, 0x6b, 0x00, 0x27, 0x1c, 0x24, 0x0c, 0x2c, 0x2c, 0x44, 0xcc, 0x24, 0x41, 0xa8, 0x00, 0x13, 0xa7, 0xa3, 0x7a, 0x50, 0x00, 0xfe, 0xeb, 0xde, 0x2f, 0x8a, 0x1e, 0x6b, 0x7b, 0x07, 0x72, 0x63, 0x09, 0xa4, 0x8e, 0xc0]),\n    VP9: new Uint8Array([0x82, 0x49, 0x83, 0x42, 0x00, 0x00, 0x00, 0x00, 0x06, 0x76, 0x38, 0x24, 0x1c, 0x19, 0xa0, 0x00, 0x00, 0x20, 0x40, 0x00, 0x11, 0xbf, 0xdd, 0x77, 0xff, 0x40, 0x7f, 0xb1, 0x00])\n  };\n  private static readonly _dummy2x2VideoPFramePerCodec = {\n    H264: new Uint8Array([\n      0x00, 0x00, 0x00, 0x01, 0x09, 0xf0, // Access unit delimiter\n      0x00, 0x00, 0x00, 0x01, 0x41, 0x9a, 0x68, 0x49, 0xa8, 0x41, 0x68, 0x99, 0x4c, 0x0f, 0xff, 0x92, 0x81]), // Slice layer: non idr data\n    VP8: new Uint8Array([0x31, 0x03, 0x00, 0xe4, 0xe0, 0xa8, 0x9b, 0x37, 0xaf, 0x10, 0x4f, 0x4f, 0xb1, 0x0a, 0x2f, 0xe4, 0x92, 0xc0, 0x1f, 0xe7, 0x4f, 0x46, 0xff, 0xee, 0x51, 0xc1, 0x5d, 0x00, 0xfe, 0xeb, 0xde, 0x2f, 0x8a, 0x1e, 0x6b, 0x7b, 0x07, 0x72, 0x63, 0x09, 0xa4, 0x8e, 0xc0]),\n    VP9: new Uint8Array([0x86, 0x00, 0x40, 0x92, 0x9c, 0x24, 0x48, 0x00, 0x00, 0x03, 0x70, 0x00, 0x00, 0x4b, 0x40])\n  };\n  private static readonly _dummy82x82H264 = {\n    IFrame: new Uint8Array([\n      0x00, 0x00, 0x00, 0x01, 0x67, 0x42, 0xc0, 0x0d, 0xda, 0x18, 0xde, 0x22, 0x22, 0x10, 0x00, 0x00, 0x03, 0x00, 0x10, 0x00, 0x00, 0x03, 0x03, 0xc8, 0xf1, 0x42, 0xaa, // Sequence parameter set\n      0x00, 0x00, 0x00, 0x01, 0x68, 0xce, 0x0f, 0xc8, // Picture parameter set\n      0x00, 0x00, 0x00, 0x01, 0x06, 0x03, ...new Uint8Array(40).fill(0xff), 0x5f, ...new Uint8Array(10295).fill(0xff), 0x80, // Supplemental enhancement information (SEI)\n      0x00, 0x00, 0x00, 0x01, 0x65, 0x88, 0x84, 0x05, ...new Uint8Array(3).fill(0xff), 0x0f, 0x45, 0x00, 0x01, 0x57, 0x9f, 0x27, 0x27, 0x27, 0x27, 0x27, 0x5d, 0x75, 0xd7, 0x5d, 0x75, 0xd7, 0x5d, 0x75, 0xd7, 0x5d, 0x75, 0xd7, 0x5d, 0x75, 0xd7, 0x5d, 0x75, 0xd7, 0x5d, 0x75, 0xd7, 0x5d, 0x78]), // Slice layer: Idr data\n    PFrame: new Uint8Array([\n      0x00, 0x00, 0x00, 0x01, 0x06, 0x03, ...new Uint8Array(40).fill(0xff), 0xa4, ...new Uint8Array(10364).fill(0xff), 0x80, // SEI\n      0x00, 0x00, 0x00, 0x01, 0x41, 0x9a, 0x20, 0x15, 0xf0, 0x4b]) // Slice layer: non idr data\n  };\n  private static readonly _dummy82x82H264PFrameFrameNumberIndex = 10418;\n  private static readonly _surrogate82x82PFrameFrameNumberReset = 1;\n  private static readonly _useUpdateSurrogate82x82PFrameFrameNumber = SurrogateFrameDataManager._isMobileChrome || SurrogateFrameDataManager._isSafari;\n  private static _surrogate82x82PFrameFrameNumber = SurrogateFrameDataManager._surrogate82x82PFrameFrameNumberReset;\n\n  static getSurrogateAudioSilentPerCodec(codec: string): ArrayBuffer | undefined {\n    switch (codec.toUpperCase()) {\n      case 'OPUS': {\n        return SurrogateFrameDataManager._dummyAudioSilentPerCodec.OPUS.buffer;\n      }\n\n      default: {\n        return undefined;\n      }\n    }\n  }\n\n  static getInvalidSurrogateAudioData(): ArrayBuffer {\n    return SurrogateFrameDataManager._singleZeroByte.buffer;\n  }\n\n  static getSurrogateVideoIFramePerCodec(codec: string): ArrayBuffer | undefined {\n    switch (codec.toUpperCase()) {\n      case 'H264': {\n        if (SurrogateFrameDataManager._useUpdateSurrogate82x82PFrameFrameNumber) {\n          SurrogateFrameDataManager._surrogate82x82PFrameFrameNumber = SurrogateFrameDataManager._surrogate82x82PFrameFrameNumberReset;\n\n          return SurrogateFrameDataManager._dummy82x82H264.IFrame.buffer;\n        }\n\n        return SurrogateFrameDataManager._dummy2x2VideoIFramePerCodec.H264.buffer;\n      }\n\n      case 'VP8': {\n        return SurrogateFrameDataManager._dummy2x2VideoIFramePerCodec.VP8.buffer;\n      }\n\n      case 'VP9': {\n        return SurrogateFrameDataManager._dummy2x2VideoIFramePerCodec.VP9.buffer;\n      }\n\n      default: {\n        return undefined;\n      }\n    }\n  }\n\n  static getInvalidSurrogateVideoIFrame(codec: string): SurrogateFrameType {\n    if ((codec.toUpperCase() === 'H264') && SurrogateFrameDataManager._useUpdateSurrogate82x82PFrameFrameNumber) {\n      SurrogateFrameDataManager._surrogate82x82PFrameFrameNumber = SurrogateFrameDataManager._surrogate82x82PFrameFrameNumberReset;\n\n      if (SurrogateFrameDataManager._isAndroidChrome) {\n        return SkipFrame;\n      }\n    }\n\n    return SurrogateFrameDataManager._singleZeroByte.buffer;\n  }\n\n  static getSurrogateVideoPFramePerCodec(codec: string): ArrayBuffer | undefined {\n    switch (codec.toUpperCase()) {\n      case 'H264': {\n        if (SurrogateFrameDataManager._useUpdateSurrogate82x82PFrameFrameNumber) {\n          const buffer = SurrogateFrameDataManager.getSurrogate82x82PFrameAndUpdateFrameNumber();\n\n          return buffer;\n        }\n\n        return SurrogateFrameDataManager._dummy2x2VideoPFramePerCodec.H264.buffer;\n      }\n\n      case 'VP8': {\n        return SurrogateFrameDataManager._dummy2x2VideoPFramePerCodec.VP8.buffer;\n      }\n\n      case 'VP9': {\n        return SurrogateFrameDataManager._dummy2x2VideoPFramePerCodec.VP9.buffer;\n      }\n\n      default: {\n        return undefined;\n      }\n    }\n  }\n\n  static getInvalidSurrogateVideoPFrame(codec: string): SurrogateFrameType {\n    if ((codec.toUpperCase() === 'H264') && SurrogateFrameDataManager._useUpdateSurrogate82x82PFrameFrameNumber) {\n      const savedSurrogateFrameNumber = SurrogateFrameDataManager._surrogate82x82PFrameFrameNumber;\n      const buffer = SurrogateFrameDataManager.getSurrogate82x82PFrameAndUpdateFrameNumber();\n\n      if (savedSurrogateFrameNumber > SurrogateFrameDataManager._surrogate82x82PFrameFrameNumberReset) {\n        if (SurrogateFrameDataManager._isAndroidChrome) {\n          return SkipFrame;\n        }\n\n        return SurrogateFrameDataManager._singleZeroByte.buffer;\n      }\n\n      SurrogateFrameDataManager._surrogate82x82PFrameFrameNumber++;\n\n      return buffer;\n    }\n\n    return SurrogateFrameDataManager._singleZeroByte.buffer;\n  }\n\n  private static getSurrogate82x82PFrameAndUpdateFrameNumber(): ArrayBuffer {\n    const bitMask1 = 0x0e;\n    const bitMask2 = 0x01;\n    const bitShiftRightBy1 = 1;\n    const bitShiftLeftBy7 = 7;\n    const byte1 = ((SurrogateFrameDataManager._surrogate82x82PFrameFrameNumber & bitMask1) >> bitShiftRightBy1);\n    const byte2 = ((SurrogateFrameDataManager._surrogate82x82PFrameFrameNumber & bitMask2) << bitShiftLeftBy7);\n    const copyOfDummyPFrames = SurrogateFrameDataManager._dummy82x82H264.PFrame.slice();\n    const buffer = copyOfDummyPFrames.buffer;\n    const bufferIndex = SurrogateFrameDataManager._dummy82x82H264PFrameFrameNumberIndex;\n\n    buffer[bufferIndex] |= byte1;\n    buffer[bufferIndex + 1] |= byte2;\n    SurrogateFrameDataManager._surrogate82x82PFrameFrameNumber++;\n\n    return buffer;\n  }\n\n  private constructor() {\n    throw new Error('SurrogateFrameDataManager is a static class that may not be instantiated');\n  }\n}","/**\n * Copyright 2024 Phenix Real Time Solutions, Inc. Confidential and Proprietary. All Rights Reserved.\n */\nimport SurrogateFrameDataManager, {SurrogateFrameType, SkipFrame} from './SurrogateFrameDataManager';\n\ntype TransformStreamPostMessage = {\n  options: {\n    kind: string;\n    codec: string;\n  };\n  readable: ReadableStream;\n  writable: WritableStream;\n};\n\ntype ForceInvalidFramePostMessage = {\n  forceInvalidFrame: boolean;\n};\n\ninterface IResponseWorker {\n  onmessage: (message: MessageEvent<ForceInvalidFramePostMessage>) => void;\n}\n\nconst worker: IResponseWorker = self as IResponseWorker;\n\nworker.onmessage = event => {\n  WorkerTransformStream.forceInvalidFrame = event.data.forceInvalidFrame;\n};\n\nif (self.RTCTransformEvent) {\n  self.onrtctransform = event => {\n    const transformer = event.transformer as TransformStreamPostMessage;\n\n    WorkerTransformStream.codec = transformer.options.codec;\n    WorkerTransformStream.transformFunction = transformer.options.kind === 'video' ? WorkerTransformStream.videoTransformFunction : WorkerTransformStream.audioTransformFunction;\n    WorkerTransformStream.forceInvalidFrame = false;\n\n    const transformStream = new TransformStream({transform: WorkerTransformStream.transformFunction});\n    const source = transformer.readable;\n    const sink = transformer.writable;\n\n    source\n      .pipeThrough(transformStream)\n      .pipeTo(sink);\n  };\n}\n\nclass WorkerTransformStream {\n  static codec: string;\n  static transformFunction: TransformerTransformCallback<AudioData | VideoFrame, TransformStreamDefaultController> | undefined;\n  static forceInvalidFrame: boolean;\n\n  static videoTransformFunction(chunk, controller): void {\n    postMessage({\n      chunk: {\n        type: chunk.type,\n        timestamp: chunk.timestamp,\n        data: chunk.data\n      }\n    });\n\n    if (WorkerTransformStream.forceInvalidFrame) {\n      let surrogate: SurrogateFrameType;\n\n      WorkerTransformStream.forceInvalidFrame = false;\n\n      if (chunk.type === 'key') {\n        surrogate = SurrogateFrameDataManager.getInvalidSurrogateVideoIFrame(WorkerTransformStream.codec);\n      } else {\n        surrogate = SurrogateFrameDataManager.getInvalidSurrogateVideoPFrame(WorkerTransformStream.codec);\n      }\n\n      if (surrogate === SkipFrame) {\n        return;\n      }\n\n      chunk.data = surrogate || chunk.data;\n    } else {\n      if (chunk.type === 'key') {\n        chunk.data = SurrogateFrameDataManager.getSurrogateVideoIFramePerCodec(WorkerTransformStream.codec) || chunk.data;\n      } else {\n        chunk.data = SurrogateFrameDataManager.getSurrogateVideoPFramePerCodec(WorkerTransformStream.codec) || chunk.data;\n      }\n    }\n\n    controller.enqueue(chunk);\n  }\n\n  static audioTransformFunction(chunk, controller): void {\n    postMessage({\n      chunk: {\n        timestamp: chunk.timestamp,\n        data: chunk.data\n      }\n    });\n\n    if (WorkerTransformStream.forceInvalidFrame) {\n      WorkerTransformStream.forceInvalidFrame = false;\n      chunk.data = SurrogateFrameDataManager.getInvalidSurrogateAudioData();\n    } else {\n      chunk.data = SurrogateFrameDataManager.getSurrogateAudioSilentPerCodec(WorkerTransformStream.codec) || chunk.data;\n    }\n\n    controller.enqueue(chunk);\n  }\n\n  private constructor() {\n    throw new Error('WorkerTransformStream is a static class that may not be instantiated');\n  }\n}\n\nexport {};"],"sourceRoot":""}